function fixEvent(a){if(a=a||window.event,null===a.pageX&&null!==a.clientX){var b=document.documentElement,c=document.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b.clientLeft||0),a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b.clientTop||0)}return!a.which&&a.button&&(a.which=1&a.button?1:2&a.button?3:4&a.button?2:0),a}function getOffset(a){return a.getBoundingClientRect?getOffsetRect(a):getOffsetSum(a)}function getOffsetRect(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function getByClass(a,b){b||(b=document);for(var c,d=b.getElementsByTagName("*"),e=-1,f=[];c=d[++e];)(" "+(c["class"]||c.className)+" ").indexOf(" "+a+" ")>-1&&f.push(c);return f}function DropTarget(a){this.canAccept=function(){return!0},this.accept=function(a){this.onLeave(),a.onDragFail()},this.onLeave=function(){},this.onEnter=function(){},this.toString=function(){return a.id},a.dropTarget=this}function DragObject(a){a.dragObject=this,dragMaster.makeDraggable(a);var b,c={};this.onDragStart=function(d){var e,f=getByClass("taracot-files-item"),g=-1;if(getByClass("taracot-files-item-selected").length||a.click(),!a.getAttribute("class").match("taracot-files-item-selected")){a.setAttribute("class",a.getAttribute("class")+" taracot-files-item-selected");var h=a.id.replace("taracot_file_","");document.getElementById("taracot_el_"+h).setAttribute("class",document.getElementById("taracot_el_"+h).getAttribute("class").replace(/taracot.fade.elipsis/,""))}for(;e=f[++g];)c[e.id]={top:e.style.top,left:e.style.left,position:e.style.position,"class":e.getAttribute("class"),zindex:e.style.zIndex};a.style.position="absolute",b=d},this.hide=function(){a.style.display="none"},this.show=function(){a.style.display=""},this.onDragMove=function(c,d){for(var e,f=getByClass("taracot-files-item-selected"),g=-1;e=f[++g];)e.id!=a.id&&(e.style.display="none");if(g>1){var h=getByClass("uk-badge",a);h&&h.length&&(h=h[0],h.innerHTML=g,h.style.display="block")}a.style.top=d-b.y+"px",a.style.left=c-b.x+"px",a.style.zIndex=500},this.onDragSuccess=function(){},this.onDragFail=function(){for(var b,d=getByClass("taracot-files-item"),e=-1;b=d[++e];){b.style.top=c[b.id].top,b.style.left=c[b.id].left,b.style.position=c[b.id].position,b.style.zIndex=c[b.id].zindex,b.setAttribute("class",c[b.id].class),b.style.display="inline-block";var f=getByClass("uk-badge",a);f&&f.length&&(f=f[0],f.innerHTML=e,f.style.display="none")}"undefined"!=typeof _dragdrop_action_taken&&(_dragdrop_action_taken=!0)},this.toString=function(){return a.id}}!function(a){a.fn.getSelected=function(b){var c=[];return a("."+b).each(function(){var b=a(this).attr("id");c.push(b)}),c},a.fn.shifty=function(b){var b=a.extend({className:"selected",select:function(){},unselect:function(){}},b);elems=a(this),last=null;var c=b.className;return a(this).each(function(){var d=a(this);this.onselectstart=function(){return!1},d.unbind("click").css({"-moz-user-select":"","-webkit-user-select":"","user-select":""}),d.click(function(e){if(!e.ctrlKey&&!e.shiftKey){if("undefined"!=typeof _dragdrop_action_taken&&_dragdrop_action_taken)return void(_dragdrop_action_taken=!1);elems.removeClass(c),a(this).addClass(c),b.unselect(elems),b.select(a(this)),last=elems.index(a(this))}e.ctrlKey&&(d.toggleClass(c),last=elems.index(d),b.unselect(elems),b.select(elems.filter("."+c))),e.shiftKey&&(first=elems.index(d),last>first?(elems.filter(":gt("+(first-1)+")").addClass(c),elems.filter(":lt("+first+"),:gt("+last+")").removeClass(c)):(elems.filter(":gt("+last+")").addClass(c),elems.filter(":lt("+last+"),:gt("+first+")").removeClass(c)),b.unselect(elems),b.select(elems.filter("."+c)))})})}}(jQuery);var dragMaster=function(){function a(a){return a=fixEvent(a),1==a.which?(i={x:a.pageX,y:a.pageY,element:this},f(a),!1):void 0}function b(a){if(a=fixEvent(a),i){if(Math.abs(i.x-a.pageX)<5&&Math.abs(i.y-a.pageY)<5)return!1;var b=i.element;h=b.dragObject;var c=d(b,i.x,i.y);i=null,h.onDragStart(c)}h.onDragMove(a.pageX,a.pageY);var f=e(a);return j!=f&&(f&&f.onEnter(),j=f),!1}function c(){h?(j?(h.onDragSuccess(j),j.accept(h),_dragdrop_action_taken=!1):h.onDragFail(),h=null):i=null,g()}function d(a,b,c){var d=getOffset(a);return{x:b-d.left,y:c-d.top}}function e(a){var b,c;navigator.userAgent.match("MSIE")||navigator.userAgent.match("Gecko")?(b=a.clientX,c=a.clientY):(b=a.pageX,c=a.pageY),h.hide();var d=document.elementFromPoint(b,c);for(h.show();d;){if(d.dropTarget&&d.dropTarget.canAccept(h))return d.dropTarget;d=d.parentNode}return null}function f(a){document.onmousemove=b,document.onmouseup=c,document.ondragstart=document.body.onselectstart=function(){return!1},a.stopPropagation()}function g(){document.onmousemove=document.onmouseup=document.ondragstart=document.body.onselectstart=null}var h,i,j;return{makeDraggable:function(b){b.onmousedown=a,document.onclick=function(){}}}}(),file_ids={},file_types={},file_mime={},current_dir="",up_dir=[],clpbrd={mode:null,dir:null,files:[]},taracot_dlg_edit=new $.UIkit.modal("#taracot_dlg_edit"),taracot_dlg_upload=new $.UIkit.modal("#taracot_dlg_upload",{bgclose:!1,keyboard:!1}),buttons_state=[],uploader,refresh_required=!1,shifty_select_handler=function(){$(".taracot-fade").addClass("taracot-fade-elipsis");for(var a=$(".taracot-files-item").getSelected("taracot-files-item-selected"),b=0;b<a.length;b++){var c=a[b].replace("taracot_file_","");$("#taracot_el_"+c).removeClass("taracot-fade-elipsis"),1==a.length&"d"==file_types[c]?$("#btn_down").attr("disabled",!1):$("#btn_down").attr("disabled",!0),1==a.length&&"application/zip"==file_mime[c]?$("#btn_unzip").attr("disabled",!1):$("#btn_unzip").attr("disabled",!0)}a.length?($("#btn_delete").attr("disabled",!1),$("#btn_copy").attr("disabled",!1),$("#btn_cut").attr("disabled",!1),$("#btn_download").attr("disabled",!1),1==a.length?$("#btn_rename").attr("disabled",!1):$("#btn_rename").attr("disabled",!0)):($("#btn_delete").attr("disabled",!0),$("#btn_copy").attr("disabled",!0),$("#btn_cut").attr("disabled",!0),$("#btn_rename").attr("disabled",!0),$("#btn_download").attr("disabled",!0))},shifty_unselect_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if($("#btn_down").attr("disabled",!0),$("#btn_unzip").attr("disabled",!0),1==a.length){var b=a[0].replace("taracot_file_","");"d"==file_types[b]&&$("#btn_down").attr("disabled",!1)}},shifty_handler=function(){shifty_select_handler(),shifty_unselect_handler()},uploader_init=function(){uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"taracot_dlg_upload_btn_add",drop_element:"taracot_upload_box",url:"/cp/files/data/upload",flash_swf_url:"/js/plupload/moxie.swf",silverlight_xap_url:"/js/plupload/moxie.xap",filters:{max_file_size:"100mb"}}),uploader.init(),uploader.bind("FilesAdded",function(a,b){uploader.files.length&&($("#uploader_dnd_hint").hide(),$("#taracot_dlg_upload_btn_clear").attr("disabled",!1),$("#taracot_dlg_upload_btn_upload").attr("disabled",!1)),plupload.each(b,function(a){$("#taracot_upload_box").append('<div class="uk-alert" id="'+a.id+'"><b>'+a.name+"</b> ("+plupload.formatSize(a.size)+')<div class="uk-progress uk-progress-mini uk-progress-success"><div class="uk-progress-bar" style="width: 0%"></div></div></div>')})}),uploader.bind("Error",function(a,b){$.UIkit.notify({message:b.file.name+": "+b.message,status:"danger",timeout:2e3,pos:"top-center"}),$("#"+b.file.id).addClass("uk-alert-danger")}),uploader.bind("UploadProgress",function(a,b){$("#"+b.id+" > .uk-progress > .uk-progress-bar").css("width",b.percent+"%")}),uploader.bind("FileUploaded",function(upldr,file,object){var data;try{data=eval(object.response)}catch(err){data=eval("("+object.response+")")}data&&(0===data.status&&data.error&&$.UIkit.notify({message:data.error,status:"danger",timeout:2e3,pos:"top-center"}),1==data.status&&($("#"+file.id).addClass("uk-alert-success"),refresh_required=!0))}),uploader.bind("UploadComplete",function(){$("#taracot_dlg_upload_btn_add").attr("disabled",!1),$("#taracot_dlg_upload_btn_clear").attr("disabled",!1),$("#taracot_dlg_upload_btn_cancel").attr("disabled",!1)})},load_files_data=function(a){save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$("#files_grid_progress").show(),$("#files_grid").empty(),null!==clpbrd.mode?$("#btn_paste").attr("disabled",!1):$("#btn_paste").attr("disabled",!0),file_ids={},file_types={},$("#files_grid").click(),$.ajax({type:"POST",url:"/cp/files/data/load",data:{dir:a},dataType:"json",success:function(b){if($("#files_grid_progress").hide(),b&&1==b.status){load_buttons_state(),shifty_handler(),$("#btn_down").attr("disabled",!0),$(".taracot-files-panel").removeClass("uk-hidden"),a?$("#btn_up").attr("disabled",!1):$("#btn_up").attr("disabled",!0),$("#btn_dummy").mouseover();for(var c=0;c<b.files.length;c++){var d="/modules/files/images/folder.png";if("f"==b.files[c].type&&(d="/modules/files/images/file.png",b.files[c].mime.match(/^image\//)&&(d="/modules/files/images/image.png"),(b.files[c].mime.match(/excel/)||b.files[c].mime.match(/csv/)||b.files[c].mime.match(/spreadsheet/))&&(d="/modules/files/images/excel.png"),(b.files[c].mime.match(/msword/)||b.files[c].mime.match(/rtf/))&&(d="/modules/files/images/word.png"),b.files[c].mime.match(/text\/plain/)&&(d="/modules/files/images/txt.png"),b.files[c].mime.match(/video/)&&(d="/modules/files/images/video.png"),b.files[c].mime.match(/pdf/)&&(d="/modules/files/images/pdf.png"),b.files[c].mime.match(/photoshop/)&&(d="/modules/files/images/psd.png"),(b.files[c].mime.match(/zip/)||b.files[c].mime.match(/rar/))&&(d="/modules/files/images/archive.png")),b.files[c].thumb&&(d="/files/"+current_dir+"/___thumb_"+b.files[c].thumb+".jpg"),file_ids[c]=b.files[c].name,file_types[c]=b.files[c].type,file_mime[c]=b.files[c].mime,$("#files_grid").append('<li class="uk-thumbnail taracot-files-item" id="taracot_file_'+c+'"><div class="uk-badge uk-badge-notification uk-badge-success" style="position:absolute;display:none">0</div><img src="'+d+'" style="max-height:70px;max-width:70px"><div class="uk-thumbnail-caption taracot-thumbnail-caption"><div class="taracot-fade taracot-fade-elipsis" id="taracot_el_'+c+'">'+b.files[c].name+"</div></div></li>"),"d"==b.files[c].type){var e=new DropTarget(document.getElementById("taracot_file_"+c));e.onLeave=drop_target_folder_onleave}}$(".taracot-files-item").shifty({className:"taracot-files-item-selected",select:function(){shifty_select_handler()},unselect:function(){shifty_unselect_handler()}});for(var f=$(".taracot-files-item"),g=0;g<f.length;g++)new DragObject(f[g]);$(".taracot-files-item").bind("dblclick",dblclick_handler),$("#taracot_total_files").html(b.files.length),b.files.length||$("#files_grid").html(_lang_vars.no_files)}else{var h=_lang_vars.ajax_failed;b.error&&(h=b.error),$.UIkit.notify({message:h,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot_total_files").html("0")}},error:function(){$("#files_grid_progress").hide(),$("#files_grid").html(_lang_vars.ajax_failed),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot_total_files").html("0"),load_buttons_state(),shifty_handler()}})},drop_target_folder_onleave=function(){cutcopy("cut");var a=current_dir+"/"+file_ids[this.toString().replace("taracot_file_","")];btnpaste_handler(a)},dblclick_handler=function(){var a=$(this).attr("id").replace("taracot_file_","");"d"==file_types[a]&&(up_dir.push(current_dir),current_dir+="/"+file_ids[a],current_dir=current_dir.replace(/^\//,""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir))},btnup_handler=function(){up_dir.length?(current_dir=up_dir[up_dir.length-1],delete up_dir[up_dir.length-1]):current_dir="","undefined"==typeof current_dir&&(current_dir=""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir)},btndown_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(a.length&&!(a.length>1)){var b=a[0].replace("taracot_file_","");"d"==file_types[b]&&(up_dir.push(current_dir),current_dir+="/"+file_ids[b],current_dir=current_dir.replace(/^\//,""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir))}},btndelete_handler=function(a){"undefined"==typeof a&&(a=!1);for(var b=$(".taracot-files-item").getSelected("taracot-files-item-selected"),c=[],d=0;d<b.length;d++){var e=b[d].replace("taracot_file_","");c.push(file_ids[e])}confirm(_lang_vars.delete_confirm+"\n\n"+c.join(", "))&&($("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$("#btn_dummy").mouseover(),$.ajax({type:"POST",url:"/cp/files/data/del",data:{dir:current_dir,items:c},dataType:"json",success:function(a){if($("#files_grid_progress").hide(),$("#files_grid").show(),load_buttons_state(),$("#btn_dummy").mouseover(),a&&1==a.status)load_files_data(current_dir),$.UIkit.notify({message:_lang_vars.delete_success,status:"success",timeout:2e3,pos:"top-center"});else{load_files_data(current_dir);var b=_lang_vars.ajax_failed;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#files_grid_progress").hide(),$("#files_grid").show(),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}}))};$("#taracot_dlg_edit_value").bind("keypress",function(a){submitOnEnter(a)&&$("#taracot_dlg_edit_btn_save").click()});var btnnewfolder_handler=function(){$("#taracot-dlg-edit-h1").html(_lang_vars.new_folder),taracot_dlg_edit.show(),$("#taracot_dlg_edit_value").val(""),$("#taracot_dlg_edit_btn_save").unbind(),$("#taracot_dlg_edit_btn_save").click(create_new_dir),$("#taracot_dlg_edit_value").focus()},create_new_dir=function(){var a=$("#taracot_dlg_edit_value").val().replace(/^\s+|\s+$/g,"");return $("#taracot_dlg_edit_value").removeClass("uk-form-danger"),a&&check_directory(a)?(taracot_dlg_edit.hide(),$("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),void $.ajax({type:"POST",url:"/cp/files/data/newdir",data:{dir:current_dir,newdir:a},dataType:"json",success:function(a){if($("#files_grid_progress").hide(),$("#files_grid").show(),load_buttons_state(),shifty_handler(),a&&1==a.status)load_files_data(current_dir),$.UIkit.notify({message:_lang_vars.newdir_success,status:"success",timeout:2e3,pos:"top-center"});else{taracot_dlg_edit.show(),$("#taracot_dlg_edit_value").focus();var b=_lang_vars.ajax_failed;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#files_grid_progress").hide(),$("#files_grid").show(),load_buttons_state(),taracot_dlg_edit.show(),shifty_handler(),$("#taracot_dlg_edit_value").focus(),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})):($("#taracot_dlg_edit_value").addClass("uk-form-danger"),void $.UIkit.notify({message:_lang_vars.invalid_dir_syntax,status:"danger",timeout:2e3,pos:"top-center"}))},btnrename_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(a&&a.length&&!(a.length>1)){var b=a[0].replace("taracot_file_","");$("#taracot-dlg-edit-h1").html(_lang_vars.rename+' <span id="taracot_rename_old_name">'+file_ids[b]+"</span>"),taracot_dlg_edit.show(),$("#taracot_dlg_edit_value").val(file_ids[b]),$("#taracot_dlg_edit_btn_save").unbind(),$("#taracot_dlg_edit_btn_save").click(rename_file),$("#taracot_dlg_edit_value").select(),$("#taracot_dlg_edit_value").focus()}},rename_file=function(){return $("#taracot_dlg_edit_value").removeClass("uk-form-danger"),check_filename($("#taracot_dlg_edit_value").val())?$("#taracot_dlg_edit_value").val()==$("#taracot_rename_old_name").html()?($("#taracot_dlg_edit_value").addClass("uk-form-danger"),void $.UIkit.notify({message:_lang_vars.cannot_rename_same,status:"danger",timeout:2e3,pos:"top-center"})):(taracot_dlg_edit.hide(),$("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),void $.ajax({type:"POST",url:"/cp/files/data/rename",data:{dir:current_dir,old_filename:$("#taracot_rename_old_name").html(),new_filename:$("#taracot_dlg_edit_value").val()},dataType:"json",success:function(a){if($("#files_grid_progress").hide(),$("#files_grid").show(),load_buttons_state(),shifty_handler(),a&&1==a.status)load_files_data(current_dir),$.UIkit.notify({message:_lang_vars.rename_success,status:"success",timeout:2e3,pos:"top-center"});else{taracot_dlg_edit.show(),$("#taracot_dlg_edit_value").focus();var b=_lang_vars.ajax_failed;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#files_grid_progress").hide(),$("#files_grid").show(),load_buttons_state(),taracot_dlg_edit.show(),shifty_handler(),$("#taracot_dlg_edit_value").focus(),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})):($("#taracot_dlg_edit_value").addClass("uk-form-danger"),void $.UIkit.notify({message:_lang_vars.invalid_filename_syntax,status:"danger",timeout:2e3,pos:"top-center"}))},cutcopy=function(a){clpbrd={mode:null,dir:null,files:[]};for(var b=$(".taracot-files-item").getSelected("taracot-files-item-selected"),c=0;c<b.length;c++){var d=b[c].replace("taracot_file_","");clpbrd.files.push(file_ids[d])}clpbrd.dir=current_dir,clpbrd.mode=a,$("#taracot-files-clipboard").html(clpbrd.files.length),$("#btn_paste").attr("disabled",!1)},btncopy_handler=function(){cutcopy("copy"),$.UIkit.notify({message:_lang_vars.clipboard_copy_success,status:"success",timeout:2e3,pos:"top-center"})},btncut_handler=function(){cutcopy("cut"),$.UIkit.notify({message:_lang_vars.clipboard_cut_success,status:"success",timeout:2e3,pos:"top-center"})},btnpaste_handler=function(a){if(null!==clpbrd.mode){var b=current_dir;if(void 0!==typeof a&&"string"==typeof a&&(b=a),clpbrd.dir==b)return void $.UIkit.notify({message:_lang_vars.cannot_paste_to_source_dir,status:"danger",timeout:2e3,pos:"top-center"});for(var c=0;c<clpbrd.files.length;c++){var d=clpbrd.dir+"/"+clpbrd.files[c];d.match(/^\//)&&(d=d.replace(/^\//,""));var e=new RegExp("^"+d+"/"),f=new RegExp("^"+d+"$");if(b.match(e)||b.match(f))return void $.UIkit.notify({message:_lang_vars.cannot_paste_to_itself,status:"danger",timeout:2e3,pos:"top-center"})}$("#btn_dummy").mouseover(),$("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$.ajax({type:"POST",url:"/cp/files/data/paste",data:{clipboard:clpbrd,dest:b},dataType:"json",success:function(a){if(load_buttons_state(),shifty_handler(),$("#files_grid_progress").hide(),$("#files_grid").show(),a&&1==a.status)$("#btn_paste").attr("disabled",!0),load_files_data(current_dir),$.UIkit.notify({message:_lang_vars.paste_success,status:"success",timeout:2e3,pos:"top-center"}),clpbrd={mode:null,dir:null,files:[]},$("#btn_paste").attr("disabled",!0),$("#taracot-files-clipboard").html("0");else{var b=_lang_vars.paste_error;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){load_buttons_state(),$("#files_grid_progress").hide(),$("#files_grid").show(),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})}},btnunzip_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(a&&a.length&&!(a.length>1)){var b=a[0].replace("taracot_file_","");"application/zip"==file_mime[b]&&($("#btn_dummy").mouseover(),$("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$.ajax({type:"POST",url:"/cp/files/data/unzip",data:{dir:current_dir,file:file_ids[b]},dataType:"json",success:function(a){if(load_buttons_state(),shifty_handler(),$("#files_grid_progress").hide(),$("#files_grid").show(),a&&1==a.status)load_files_data(current_dir),$.UIkit.notify({message:_lang_vars.unzip_success,status:"success",timeout:2e3,pos:"top-center"});else{var b=_lang_vars.unzip_error;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){load_buttons_state(),$("#files_grid_progress").hide(),$("#files_grid").show(),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}}))}},btndownload_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(a.length){for(var b=[],c=0;c<a.length;c++){var d=a[c].replace("taracot_file_","");b.push(file_ids[d])}$("#btn_dummy").mouseover(),$("#files_grid_progress").show(),$("#files_grid").hide(),save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$.fileDownload("/cp/files/data/download",{httpMethod:"POST",data:{dir:current_dir,files:b},successCallback:function(){load_buttons_state(),shifty_handler(),$("#files_grid_progress").hide(),$("#files_grid").show()},failCallback:function(a){load_buttons_state(),shifty_handler(),$("#files_grid_progress").hide(),$("#files_grid").show();var b=JSON.parse(a),c=_lang_vars.download_error;b.error&&(c=b.error),$.UIkit.notify({message:c,status:"danger",timeout:2e3,pos:"top-center"})}})}},btnupload_handler=function(){refresh_required=!1,taracot_dlg_upload.show(),$("#btn_dummy").mouseover(),$("#taracot_dlg_upload_btn_clear").attr("disabled",!0),$("#taracot_dlg_upload_btn_upload").attr("disabled",!0),uploader||uploader_init(),uploader.splice(0),$("#taracot_upload_box").html('<div style="text-align:center" id="uploader_dnd_hint">'+_lang_vars.drag_and_drop_files_here+"</div>")},btnrefresh_hanlder=function(){load_files_data(current_dir)},dlguploadbtnclear_handler=function(){$("#taracot_dlg_upload_btn_clear").attr("disabled",!0),$("#taracot_dlg_upload_btn_upload").attr("disabled",!0),uploader.splice(0),$("#taracot_upload_box").empty(),$("#taracot_upload_box").html('<div style="text-align:center" id="uploader_dnd_hint">'+_lang_vars.drag_and_drop_files_here+"</div>")},dlguploadbtnupload_handler=function(){uploader.files.length&&(uploader.settings.multipart_params={dir:current_dir},$(".taracot-upload-btn").attr("disabled",!0),uploader.start())},save_buttons_state=function(){buttons_state=[],$(".taracot-files-button").each(function(){buttons_state.push($(this).attr("disabled"))})},load_buttons_state=function(){$(".taracot-files-button").each(function(a){buttons_state.length<a||(buttons_state[a]?$(this).attr("disabled",!0):$(this).attr("disabled",!1))})},init_buttons_state=function(){$("#btn_refresh").attr("disabled",!1),$("#btn_down").attr("disabled",!0),$("#btn_up").attr("disabled",!0),$("#btn_new_folder").attr("disabled",!1),$("#btn_copy").attr("disabled",!0),$("#btn_cut").attr("disabled",!0),$("#btn_paste").attr("disabled",!0),$("#btn_rename").attr("disabled",!0),$("#btn_delete").attr("disabled",!0),$("#btn_upload").attr("disabled",!1),$("#btn_download").attr("disabled",!0),$("#btn_unzip").attr("disabled",!0)};$("#btn_refresh").click(btnrefresh_hanlder),$("#btn_new_folder").click(btnnewfolder_handler),$("#btn_up").click(btnup_handler),$("#btn_down").click(btndown_handler),$("#btn_delete").click(btndelete_handler),$("#btn_copy").click(btncopy_handler),$("#btn_cut").click(btncut_handler),$("#btn_paste").click(btnpaste_handler),$("#btn_rename").click(btnrename_handler),$("#btn_upload").click(btnupload_handler),$("#btn_download").click(btndownload_handler),$("#btn_unzip").click(btnunzip_handler),$("#taracot_dlg_upload_btn_clear").click(dlguploadbtnclear_handler),$("#taracot_dlg_upload_btn_upload").click(dlguploadbtnupload_handler),$(document).ready(function(){$("#files_grid_progress").hide(),init_buttons_state(),load_files_data();var a=new DropTarget(document.getElementById("btn_delete"));a.onLeave=function(){btndelete_handler(!0)},$("#files_grid").click(function(a){"files_grid"===a.target.id&&($(".taracot-files-item").removeClass("taracot-files-item-selected"),$(".taracot-fade").addClass("taracot-fade-elipsis"),$("#btn_down").attr("disabled",!0),shifty_handler())}),$("#taracot_dlg_upload").on({"uk.modal.hide":function(){refresh_required&&load_files_data(current_dir)}})});var check_filename=function(a){var b=a.replace(/^\s+|\s+$/g,"");return!b||b.length>80?!1:b.match(/^\./)?!1:b.match(/^[\^<>\:\"\/\\\|\?\*\x00-\x1f]+$/)?!1:!0},check_directory=function(a){if(!a)return!0;var b=a.replace(/^\s+|\s+$/g,"");return b.length>40?!1:b.match(/^\./)?!1:b.match(/^\\/)?!1:b.match(/^[\^<>\:\"\\\|\?\*\x00-\x1f]+$/)?!1:!0};