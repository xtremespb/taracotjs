var edit_modal=new UIkit.modal("#taracot-modal-edit",{bgclose:!1,keyboard:!1}),locked_modal=new UIkit.modal("#dlg_locked"),current_id="",current_shipping_address={},process_rows=[function(a,b){return'<label><input type="checkbox" class="taracot-table-chbx" id="taracot-table-chbx-'+b+'" rel="taracot-item_'+a+'"></div>&nbsp;'+a+"</label>"},function(a){return"<div>"+a+"</div>"},function(a){return"<div>"+a+"</div>"},function(a){return"<div>"+a+"</div>"},function(a,b){return'<div style="text-align:center"><button class="uk-icon-button uk-icon-edit taracot-tableitem-edit" id="taracot-btnedt-'+b+'" type="button"></button>&nbsp;<button class="uk-icon-button uk-icon-button-danger uk-icon-trash-o taracot-tableitem-delete" id="taracot-btndel-'+b+'" type="button"></button></div>'}];$("#btn-select-all").click(function(){$(".taracot-table-chbx").prop("checked",!0)}),$("#btn-select-none").click(function(){$(".taracot-table-chbx").prop("checked",!1)}),$("#btn-delete-selected").click(function(){var a=[];$(".taracot-table-chbx").each(function(b,c){$(c).prop("checked")&&a.push($(c).attr("id").replace("taracot-table-chbx-",""))}),a.length>0&&delete_item(a)});var load_edit_data=function(a){$.ajax({type:"POST",url:"/cp/catalog_orders/data/load",data:{id:a},dataType:"json",success:function(a){if($("#taracot-modal-edit-loading").addClass("uk-hidden"),1==a.status){$(".taracot-buttons-area").show(),$("#catalog_cart_add_btn > i").show(),$("#catalog_cart_add_btn > img").hide(),$("#catalog_cart_add_btn").attr("disabled",!1),$("#catalog_cart_add_sku").removeClass("uk-form-danger"),$(".order-edit-field").each(function(){$(this).val(""),$(this)[0].selectedIndex=0}),$("#taracot-modal-edit-wrap").removeClass("uk-hidden"),a.data&&(a=a.data),a.order_id&&$("#order_id").html(a.order_id),a.order_timestamp&&$("#order_date").html(a.order_timestamp),a.order_status&&$("#order_status").val(a.order_status),a.ship_method&&$("#shipping_method").val(a.ship_method),a.sum_subtotal&&$("#sum_subtotal").val(a.sum_subtotal),a.sum_total&&$("#sum_total").val(a.sum_total),a.sum_total&&$("#sum_total").val(a.sum_total),a.ship_comment&&$("#shipping_comment").val(a.ship_comment),a.ship_track&&$("#ship_track").val(a.ship_track),a.shipping_address&&(a.shipping_address.ship_name&&$("#ship_name").val(a.shipping_address.ship_name),a.shipping_address.ship_street&&$("#ship_street").val(a.shipping_address.ship_street),a.shipping_address.ship_city&&$("#ship_city").val(a.shipping_address.ship_city),a.shipping_address.ship_region&&$("#ship_region").val(a.shipping_address.ship_region),a.shipping_address.ship_country&&$("#ship_country").val(a.shipping_address.ship_country),a.shipping_address.ship_zip&&$("#ship_zip").val(a.shipping_address.ship_zip),a.shipping_address.ship_phone&&$("#ship_phone").val(a.shipping_address.ship_phone)),$("#edit_order_general_li").click(),$("#order_cart_body").empty();var b=a.warehouse_titles||{};if(a.cart_data)for(var c in a.cart_data){var d=b[c]||c,e=a.cart_data[c];$("#order_cart_body").append('<tr><td class="order_cart_title" rel="'+c+'">'+d+" ["+c+']</td><td class="order_cart_amount"><input class="uk-width-1-1 uk-form-small" id="cart_item_'+c+'" value="'+e+'"></td><td class="order_cart_del"><button class="uk-button uk-button-mini uk-button-danger order-cart-del-btn"><i class="uk-icon-trash-o"></i></button></td></tr>')}$(".order-cart-del-btn").unbind(),$(".order-cart-del-btn").click(order_cart_del_btn_handler),$("#order_status").focus(),_generate_address()}else a.locked_by?($("#order_locked_by").html(a.locked_by),edit_modal.hide(),$("#dlg_locked_loading").hide(),$("#dlg_locked_wrap").show(),locked_modal.show()):$("#taracot-modal-edit-loading-error").removeClass("uk-hidden")},error:function(){$("#taracot-modal-edit-loading").addClass("uk-hidden"),$("#taracot-modal-edit-loading-error").removeClass("uk-hidden")}})},order_cart_del_btn_handler=function(){$(this).parent().parent().remove()};$("#taracot_edit_btn_cancel_order").click(function(){confirm(_lang_vars.order_cancel_confirm)&&($("#taracot-modal-edit-wrap").addClass("uk-hidden"),$("#taracot-modal-edit-loading").removeClass("uk-hidden"),$("#taracot-modal-edit-loading-error").addClass("uk-hidden"),$(".taracot-buttons-area").hide(),$.ajax({type:"POST",url:"/cp/catalog_orders/data/cancel",data:{id:current_id},dataType:"json",success:function(a){if($("#taracot-modal-edit-loading").addClass("uk-hidden"),1==a.status)$("#taracot_table").medvedTable("update"),edit_modal.hide(),UIkit.notify({message:_lang_vars.save_success,status:"success",timeout:2e3,pos:"top-center"});else{$("#taracot-modal-edit-wrap").removeClass("uk-hidden"),$(".taracot-buttons-area").show();var b=_lang_vars.form_err_msg;a.error&&(b=a.error),UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#taracot-modal-edit-loading").addClass("uk-hidden"),$("#taracot-modal-edit-wrap").removeClass("uk-hidden"),$(".taracot-buttons-area").show(),UIkit.notify({message:_lang_vars.form_err_msg,status:"danger",timeout:2e3,pos:"top-center"})}}))}),$("#catalog_cart_add_btn").click(function(){$("#catalog_cart_add_sku").removeClass("uk-form-danger");var a=$.trim($("#catalog_cart_add_sku").val());return a.match(/^[A-Za-z0-9_\-\.]{1,80}$/)?($("#catalog_cart_add_btn > i").hide(),$("#catalog_cart_add_btn > img").show(),$("#catalog_cart_add_btn").attr("disabled",!0),void $.ajax({type:"POST",url:"/cp/catalog_orders/data/sku",data:{sku:a},dataType:"json",success:function(b){var c=a;1==b.status&&b.title&&(c=b.title),$("#order_cart_body").append('<tr><td class="order_cart_title" rel="'+a+'">'+c+" ["+a+']</td><td class="order_cart_amount"><input class="uk-width-1-1 uk-form-small" id="cart_item_'+a+'" value="1"></td><td class="order_cart_del"><button class="uk-button uk-button-mini uk-button-danger order-cart-del-btn"><i class="uk-icon-trash-o"></i></button></td></tr>'),$(".order-cart-del-btn").unbind(),$(".order-cart-del-btn").click(order_cart_del_btn_handler)},error:function(){$("#catalog_cart_add_sku").addClass("uk-form-danger"),$("#catalog_cart_add_sku").focus()},complete:function(){$("#catalog_cart_add_btn > i").show(),$("#catalog_cart_add_btn > img").hide(),$("#catalog_cart_add_btn").attr("disabled",!1)}})):$("#catalog_cart_add_sku").addClass("uk-form-danger")&&$("#catalog_cart_add_sku").focus()});var edit_item=function(a){current_id=a,edit_modal.show(),$("#shipping_address").val(""),$("#taracot-modal-edit-wrap > form.uk-form > fieldset > div.uk-form-row > input").removeClass("uk-form-danger"),$("#taracot-modal-edit-wrap > form.uk-form > fieldset > div.uk-form-row > input").val(""),$("#taracot-modal-edit-wrap").addClass("uk-hidden"),$("#taracot-modal-edit-loading").removeClass("uk-hidden"),$("#taracot-modal-edit-loading-error").addClass("uk-hidden"),$("#order_save_error").hide(),$(".taracot-buttons-area").hide(),load_edit_data(a)};$("#taracot-edit-btn-save").click(function(){$("#order_save_error").hide(),$(".order-edit-field").each(function(){$(this).removeClass("uk-form-danger")});var a=[],b=parseInt($("#order_status").val()),c=parseFloat($("#sum_subtotal").val()),d=parseFloat($("#sum_total").val()),e=$("#shipping_method").val(),f=$.trim($("#ship_name").val()),g=$.trim($("#ship_street").val()),h=$.trim($("#ship_city").val()),i=$.trim($("#ship_region").val()),j=$("#ship_country").val(),k=$.trim($("#ship_zip").val()),l=$.trim($("#ship_phone").val()),m=$.trim($("#shipping_comment").val()),n=$.trim($("#ship_track").val()),o={};if((!c||0>c)&&a.push("#sum_subtotal"),(!d||0>d)&&a.push("#sum_total"),f&&(!f.length||f.length>80)&&a.push("#ship_name"),g&&(!g.length||g.length>120)&&a.push("#ship_street"),h&&(!h.length||h.length>120)&&a.push("#ship_city"),i&&(!i.length||i.length>120)&&a.push("#ship_region"),j&&!j.match(/^[A-Z]{2}$/)&&a.push("#ship_country"),k&&!k.match(/^[0-9]{5,6}$/)&&a.push("#ship_zip"),l&&!l.match(/^[0-9\+]{1,40}$/)&&a.push("#ship_phone"),n&&n.length>80&&a.push("#ship_track"),m&&m.length>1024&&a.push("#ship_comment"),a.length){for(var p=!1,q=0;q<a.length;q++)$(a[q]).addClass("uk-form-danger");return p||($(a[q]).focus(),p=!0),$("#order_save_error").show()}$("#order_cart_body").children().each(function(){var a=String($(this).children(":first").attr("rel")),b=parseInt($("#cart_item_"+a).val())||1;o[a+" "]=b+" "}),$("#taracot-modal-edit-wrap").addClass("uk-hidden"),$("#taracot-modal-edit-loading").removeClass("uk-hidden"),$("#taracot-modal-edit-loading-error").addClass("uk-hidden"),$(".taracot-buttons-area").hide(),$.ajax({type:"POST",url:"/cp/catalog_orders/data/save",data:{id:current_id,order_status:b,sum_subtotal:c,sum_total:d,shipping_method:e,shipping_address:{ship_name:f,ship_street:g,ship_city:h,ship_region:i,ship_country:j,ship_zip:k,ship_phone:l},ship_comment:m,ship_track:n,cart_data:o},dataType:"json",success:function(a){if($("#taracot-modal-edit-loading").addClass("uk-hidden"),1==a.status)$("#taracot_table").medvedTable("update"),edit_modal.hide(),UIkit.notify({message:_lang_vars.save_success,status:"success",timeout:2e3,pos:"top-center"});else{$("#taracot-modal-edit-wrap").removeClass("uk-hidden"),$(".taracot-buttons-area").show();var b=_lang_vars.form_err_msg;if(a.error&&(b=a.error),a.err_fields&&a.err_fields.length)for(var c=!1,d=0;d<a.err_fields.length;d++)$("#"+a.err_fields[d]).addClass("uk-form-danger"),c||($("#"+a.err_fields[d]).focus(),c=!0);UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#taracot-modal-edit-loading").addClass("uk-hidden"),$("#taracot-modal-edit-wrap").removeClass("uk-hidden"),$(".taracot-buttons-area").show(),UIkit.notify({message:_lang_vars.form_err_msg,status:"danger",timeout:2e3,pos:"top-center"})}})}),$("#taracot-edit-btn-cancel").click(function(){$("#order_save_error").hide(),$("#taracot-modal-edit-wrap").addClass("uk-hidden"),$("#taracot-modal-edit-loading").removeClass("uk-hidden"),$("#taracot-modal-edit-loading-error").addClass("uk-hidden"),$(".taracot-buttons-area").hide(),$.ajax({type:"POST",url:"/cp/catalog_orders/data/unlock",data:{id:current_id},dataType:"json",complete:function(){$("#taracot-modal-edit-loading").addClass("uk-hidden"),edit_modal.hide()}})});var delete_item=function(a){for(var b=[],c=0;c<a.length;c++)b.push($("#taracot-table-chbx-"+a[c]).attr("rel").replace("taracot-item_",""));confirm(_lang_vars.del_confirm+"\n\n"+b.join(", "))&&($("#taracot_table").medvedTable("loading_indicator_show"),$.ajax({type:"POST",url:"/cp/catalog_orders/data/delete",data:{ids:a},dataType:"json",success:function(a){$("#taracot_table").medvedTable("loading_indicator_hide"),1==a.status?$("#taracot_table").medvedTable("update"):UIkit.notify({message:_lang_vars.delete_err_msg,status:"danger",timeout:2e3,pos:"top-center"})},error:function(){$("#taracot_table").medvedTable("loading_indicator_hide"),UIkit.notify({message:_lang_vars.delete_err_msg,status:"danger",timeout:2e3,pos:"top-center"})}}))};$(".taracot-edit-form > fieldset > .uk-form-row > input, .taracot-edit-form > fieldset > .uk-form-row > select").bind("keypress",function(a){submitOnEnter(a)&&$("#taracot-edit-btn-save").click()}),$("#order_steal_lock").click(function(){$("#dlg_locked_loading").show(),$("#dlg_locked_wrap").hide(),$.ajax({type:"POST",url:"/cp/catalog_orders/data/unlock",data:{id:current_id},dataType:"json",success:function(a){1==a.status?edit_item(current_id):UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})},error:function(){UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})},complete:function(){$("#dlg_locked_loading").hide(),$("#dlg_locked_wrap").show(),locked_modal.hide()}})});var _generate_address=function(){var a=$("#ship_name").val()+"\n"+$("#ship_street").val()+"\n"+$("#ship_city").val()+"\n"+$("#ship_region").val()+"\n"+$("#ship_zip").val()+" "+$("#ship_country option:selected").text();$("#shipping_address").val(a)};$(".order-edit-field").change(_generate_address),$("#shipping_address").click(function(){$("#shipping_address").select()}),$(document).ready(function(){$("#shipping_address").prop("readonly",!0),$("#taracot_table").medvedTable({col_count:5,sort_mode:-1,sort_cell:"order_timestamp",taracot_table_url:"/cp/catalog_orders/data/list",process_rows:process_rows,error_message:_lang_vars.ajax_failed})});