function submitOnEnter(a){var b;if(window.event)b=window.event.keyCode;else{if(!a)return!1;b=a.keyCode?a.keyCode:a.which}return 13==b&&(!window.previousKeyCode||33!=window.previousKeyCode&&34!=window.previousKeyCode&&39!=window.previousKeyCode&&40!=window.previousKeyCode)?!0:(window.previousKeyCode=b,!1)}var captcha_loading=!1,load_captcha=function(){return"undefined"!=typeof captcha_type&&"png"==captcha_type?void $("#auth_captcha_img").attr("src","/auth/captcha?rnd="+Math.random().toString().replace(".","")):void(captcha_loading||(captcha_loading=!0,$.ajax({type:"POST",url:"/auth/captcha",data:{},dataType:"json",success:function(a){captcha_loading=!1,a.img?$("#auth_captcha_img").attr("src","data:image/jpeg;base64,"+a.img):($("#taracot-login-error").html(_lang_vars.ajax_failed),$("#taracot-login-error").show())},error:function(){$("#taracot-login-error").html(_lang_vars.ajax_failed),$("#taracot-login-error").show(),captcha_loading=!1}})))};$("#auth_captcha_img").click(load_captcha),$("#btn_login").click(function(){return $("#taracot-login-error").hide(),$(".taracot-auth-field").removeClass("uk-form-danger"),$("#auth_username").val().match(/^[A-Za-z0-9_\-]{3,20}$/)?$("#auth_password").val().match(/^.{5,80}$/)?captcha_req&&!$("#auth_captcha").val().match(/^[0-9]{4}$/)?($("#auth_captcha").addClass("uk-form-danger"),$("#auth_captcha").focus(),$("#taracot-login-error").html(_lang_vars.invalid_captcha),void $("#taracot-login-error").show()):($("#auth_wrap").hide(),$("#auth_loading").show(),void $.ajax({type:"POST",url:"/auth/process",data:{username:$("#auth_username").val(),password:$("#auth_password").val(),captcha:$("#auth_captcha").val()},dataType:"json",success:function(a){1!=a.result?($("#auth_captcha").val(""),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#captcha_div").show(),captcha_req=!0,a.error&&($("#taracot-login-error").html(a.error),$("#taracot-login-error").show()),$("#auth_wrap").show(),$("#auth_loading").hide(),load_captcha()):($("#auth_form").hide(),location.href=redirect_host+redirect_url+"?rnd="+Math.random().toString().replace(".",""))},error:function(){$("#auth_wrap").show(),$("#auth_loading").hide(),$("#taracot-login-error").html(_lang_vars.ajax_failed),$("#taracot-login-error").show(),load_captcha()}})):($("#auth_password").addClass("uk-form-danger"),$("#auth_password").focus(),$("#taracot-login-error").html(_lang_vars.invalid_password_syntax),void $("#taracot-login-error").show()):($("#auth_username").addClass("uk-form-danger"),$("#auth_username").focus(),$("#taracot-login-error").html(_lang_vars.invalid_username_syntax),void $("#taracot-login-error").show())}),$(".taracot-auth-field").bind("keypress",function(a){submitOnEnter(a)&&($("#btn_login").click(),a.preventDefault())}),$("#auth_username").focus(),$(document).ready(function(){load_captcha();var a="";for(var b in config_auth){var c=config_auth[b].requestURL.replace("[client_id]",config_auth[b].clientID).replace("[redirect_uri]",config_auth[b].callbackURL),d=b.charAt(0).toUpperCase()+b.slice(1),e=b;"yandex"==e&&(e="hacker-news"),a+='<a href="'+c+'" class="uk-button"><i class="uk-icon-'+e+'"></i>&nbsp;'+d+"</a>&nbsp;"}a&&($("#auth_social").html('<div class="uk-margin-top">'+_lang_vars.social_hint+':</div><div class="uk-margin-bottom uk-margin-top" data-uk-margin>'+a+"</div>"),$("#auth_social").show())}),function(a){a.queryString=function(a){if(""===a)return{};for(var b={},c=0;c<a.length;++c){var d=a[c].split("=");2==d.length&&(b[d[0]]=decodeURIComponent(d[1].replace(/\+/g," ")))}return b}(window.location.search.substr(1).split("&"))}(jQuery);