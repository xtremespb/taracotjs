function submitOnEnter(a){var b;if(window.event)b=window.event.keyCode;else{if(!a)return!1;b=a.keyCode?a.keyCode:a.which}return 13==b&&(!window.previousKeyCode||33!=window.previousKeyCode&&34!=window.previousKeyCode&&39!=window.previousKeyCode&&40!=window.previousKeyCode)?!0:(window.previousKeyCode=b,!1)}!function(a){var b;jQuery&&jQuery.UIkit&&(b=a(jQuery,jQuery.UIkit)),"function"==typeof define&&define.amd&&define("uikit-notify",["uikit"],function(){return b||a(jQuery,jQuery.UIkit)})}(function(a,b){var c={},d={},e=function(b){return"string"==a.type(b)&&(b={message:b}),arguments[1]&&(b=a.extend(b,"string"==a.type(arguments[1])?{status:arguments[1]}:arguments[1])),new g(b).show()},f=function(a,b){if(a)for(var c in d)a===d[c].group&&d[c].close(b);else for(var c in d)d[c].close(b)},g=function(b){this.options=a.extend({},g.defaults,b),this.uuid="ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random()),this.element=a(['<div class="uk-notify-message">','<a class="uk-close"></a>',"<div>"+this.options.message+"</div>","</div>"].join("")).data("notifyMessage",this),this.options.status&&(this.element.addClass("uk-notify-message-"+this.options.status),this.currentstatus=this.options.status),this.group=this.options.group,d[this.uuid]=this,c[this.options.pos]||(c[this.options.pos]=a('<div class="uk-notify uk-notify-'+this.options.pos+'"></div>').appendTo("body").on("click",".uk-notify-message",function(){a(this).data("notifyMessage").close()}))};return a.extend(g.prototype,{uuid:!1,element:!1,timout:!1,currentstatus:"",group:!1,show:function(){if(!this.element.is(":visible")){var a=this;c[this.options.pos].show().prepend(this.element);var b=parseInt(this.element.css("margin-bottom"),10);return this.element.css({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0}).animate({opacity:1,"margin-top":0,"margin-bottom":b},function(){if(a.options.timeout){var b=function(){a.close()};a.timeout=setTimeout(b,a.options.timeout),a.element.hover(function(){clearTimeout(a.timeout)},function(){a.timeout=setTimeout(b,a.options.timeout)})}}),this}},close:function(a){var b=this,e=function(){b.element.remove(),c[b.options.pos].children().length||c[b.options.pos].hide(),delete d[b.uuid]};this.timeout&&clearTimeout(this.timeout),a?e():this.element.animate({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0},function(){e()})},content:function(a){var b=this.element.find(">div");return a?(b.html(a),this):b.html()},status:function(a){return a?(this.element.removeClass("uk-notify-message-"+this.currentstatus).addClass("uk-notify-message-"+a),this.currentstatus=a,this):this.currentstatus}}),g.defaults={message:"",status:"",timeout:5e3,group:null,pos:"top-center"},b.notify=e,b.notify.message=g,b.notify.closeAll=f,e});var dlg_password=new $.UIkit.modal("#dlg_password"),dlg_email=new $.UIkit.modal("#dlg_email"),dlg_realname=new $.UIkit.modal("#dlg_realname"),uploader;$("#btn_password").click(function(){dlg_password.show(),pc_password_event_input(),$("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),$("#taracot_pc_error").hide(),$(".taracot_pc_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#password_current").focus()});var pc_password_event_input=function(){var a=evalPassword($("#pc_password").val()),b=20*(a+1);$("#pc_password_strength").css("width",b+"%"),$("#pc_password_strength").html(_lang_vars["password_strength_"+a]),$("#pc_password_strength").parent().removeClass("uk-progress-success"),$("#pc_password_strength").parent().removeClass("uk-progress-warning"),console.log($("#pc_password_strength").parent()),$("#pc_password_strength").parent().removeClass("uk-progress-danger"),1>=a&&$("#pc_password_strength").parent().addClass("uk-progress-danger"),(2==a||3==a)&&$("#pc_password_strength").parent().addClass("uk-progress-warning"),4==a&&$("#pc_password_strength").parent().addClass("uk-progress-success")};$("#pc_password").on("input",pc_password_event_input),$("#btn_pc_save").click(function(){return $(".taracot_pc_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#password_current").val().match(/^.{5,80}$/)?$("#pc_password").val().match(/^.{8,80}$/)&&$("#pc_password").val()==$("#pc_password_repeat").val()?($("#taracot_pc_loading").show(),$("#dlg_password_form_wrap").hide(),$("#taracot_pc_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#password_current").val(),password_new:$("#pc_password").val()},dataType:"json",success:function(a){dlg_allow_close(!0),1!=a.result?($("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_pc_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_pc_error").show()):(dlg_password.hide(),$.UIkit.notify({message:_lang_vars.password_saved,status:"success",timeout:2e3,pos:"top-center"}))},error:function(){dlg_allow_close(!0),$("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),$("#taracot_pc_error").html(_lang_vars.ajax_failed),$("#taracot_pc_error").show(),$("#password_current").focus()}})):($("#pc_password").addClass("uk-form-danger"),$("#pc_password_repeat").addClass("uk-form-danger"),$("#pc_password").focus(),$("#taracot_pc_error").html(_lang_vars.invalid_password_syntax),void $("#taracot_pc_error").show()):($("#password_current").addClass("uk-form-danger"),$("#password_current").focus(),$("#taracot_pc_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_pc_error").show())}),$(".taracot_pc_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_pc_save").click()}),$("#btn_email").click(function(){dlg_email.show(),$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),$("#taracot_ec_error").hide(),$(".taracot_ec_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#ec_email").focus()}),$("#btn_ec_save").click(function(){return $(".taracot_ec_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#ec_email").val().match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?$("#ec_password_current").val().match(/^.{5,80}$/)?($("#taracot_ec_loading").show(),$("#dlg_email_form_wrap").hide(),$("#taracot_ec_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#ec_password_current").val(),email_new:$("#ec_email").val()},dataType:"json",success:function(a){$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),1!=a.result?(dlg_allow_close(!0),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_ec_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_ec_error").show()):($("#dlg_email_form_wrap").html(_lang_vars.email_saved),setTimeout(function(){location.href="/auth/profile?rnd="+Math.random().toString().replace(".","")},3e3))},error:function(){dlg_allow_close(!0),$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),$("#taracot_ec_error").html(_lang_vars.ajax_failed),$("#taracot_ec_error").show(),$("#ec_password_current").focus()}})):($("#ec_password_current").addClass("uk-form-danger"),$("#ec_password_current").focus(),$("#taracot_ec_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_ec_error").show()):($("#ec_email").addClass("uk-form-danger"),$("#ec_email").focus(),$("#taracot_ec_error").html(_lang_vars.invalid_email_syntax),void $("#taracot_ec_error").show())}),$(".taracot_ec_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_ec_save").click()}),$("#btn_realname").click(function(){dlg_realname.show(),$("#taracot_rn_loading").hide(),$("#dlg_realname_form_wrap").show(),$("#taracot_rn_error").hide(),$(".taracot_rn_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#rn_realname").val(auth_realname),$("#rn_realname").select(),$("#rn_realname").focus()}),$("#btn_rn_save").click(function(){return $(".taracot_rn_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#rn_realname").val().match(/^.{1,40}$/)?$("#rn_password_current").val().match(/^.{5,80}$/)?($("#taracot_rn_loading").show(),$("#dlg_email_form_wrap").hide(),$("#taracot_rn_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#rn_password_current").val(),realname:$("#rn_realname").val()},dataType:"json",success:function(a){$("#taracot_rn_loading").hide(),$("#dlg_email_form_wrap").show(),1!=a.result?(dlg_allow_close(!0),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_rn_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_rn_error").show()):(dlg_realname.hide(),a.realname?($("#profile_realname").html(a.realname),auth_realname=a.realname):($("#profile_realname").html(""),auth_realname=""),$.UIkit.notify({message:_lang_vars.realname_saved,status:"success",timeout:2e3,pos:"top-center"}))},error:function(){dlg_allow_close(!0),$("#taracot_rn_loading").hide(),$("#dlg_email_form_wrap").show(),$("#taracot_rn_error").html(_lang_vars.ajax_failed),$("#taracot_rn_error").show(),$("#rn_password_current").focus()}})):($("#rn_password_current").addClass("uk-form-danger"),$("#rn_password_current").focus(),$("#taracot_rn_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_rn_error").show()):($("#rn_realname").addClass("uk-form-danger"),$("#rn_realname").focus(),$("#taracot_rn_error").html(_lang_vars.invalid_realname_syntax),void $("#taracot_rn_error").show())}),$(".taracot_rn_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_rn_save").click()}),$("#btn_logout").click(function(){location.href="/auth/logout?rnd="+Math.random().toString().replace(".","")}),$("#profile_set_avatar").click(function(){});var dlg_allow_close=function(a){dlg_password.options.bgclose=a,dlg_password.options.keyboard=a,dlg_email.options.bgclose=a,dlg_email.options.keyboard=a,dlg_realname.options.bgclose=a,dlg_realname.options.keyboard=a},uploader_init=function(){uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"profile_set_avatar",drop_element:"profile_set_avatar_dnd",url:"/auth/profile/process",flash_swf_url:"/js/plupload/moxie.swf",silverlight_xap_url:"/js/plupload/moxie.xap",filters:{max_file_size:"3mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}]},multi_selection:!1}),uploader.init(),uploader.bind("FilesAdded",function(){uploader.start()}),uploader.bind("Error",function(a,b){taracot_progress_indicator("body",!1),$.UIkit.notify({message:b.message,status:"danger",timeout:2e3,pos:"top-center"})}),uploader.bind("UploadProgress",function(){taracot_progress_indicator("body",!0)}),uploader.bind("FileUploaded",function(upldr,file,object){taracot_progress_indicator("body",!1);var data;try{data=eval(object.response)}catch(err){data=eval("("+object.response+")")}data&&(0===data.result&&data.error&&$.UIkit.notify({message:data.error,status:"danger",timeout:2e3,pos:"top-center"}),1==data.result&&data.avatar_id&&$("#profile_avatar").attr("src","/img/avatars/"+data.avatar_id+".jpg"))})},taracot_progress_indicator=function(a,b){if(b){var c=$(a).offset();$(".taracot-progress").css({top:c.top,left:c.left,width:$(a).width(),height:$(a).height()}),$(".taracot-progress").show()}else $(".taracot-progress").hide()};$(document).ready(function(){uploader_init()});