function submitOnEnter(a){var b;if(window.event)b=window.event.keyCode;else{if(!a)return!1;b=a.keyCode?a.keyCode:a.which}return 13==b&&(!window.previousKeyCode||33!=window.previousKeyCode&&34!=window.previousKeyCode&&39!=window.previousKeyCode&&40!=window.previousKeyCode)?!0:(window.previousKeyCode=b,!1)}function evalPassword(a){var b=a.replace(/(^\s+|\s+$)/g,"");if("undefined"==typeof b||null===b||!b||b.length<8)return 0;var c=/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/;return c.test(b)?4:(c=/(?=.*\d)(?=.*[A-Z])(?=.*[a-z])/,c.test(b)?3:(c=/(?=.*\d)(?=.*[a-z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*\d)(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*[a-z])(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*[a-z])(?=.*[A-Z])/,c.test(b)?2:(c=/(?=.*[a-z])(?=.*\d)/,c.test(b)?2:(c=/(?=.*[A-Z])(?=.*\d)/,c.test(b)?2:(c=/(?=.*[a-z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''""()\[\]{}])/,c.test(b)?2:(c=/(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''""()\[\]{}])/,c.test(b)?2:(c=/(?=.*\d)(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?2:(c=/(?=.*[a-zA-Z0-9\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}\u0400-\u052f \u00a1-\u024f])/,c.test(b)?1:0)))))))))))}!function(a){a.queryString=function(a){if(""===a)return{};for(var b={},c=0;c<a.length;++c){var d=a[c].split("=");2==d.length&&(b[d[0]]=decodeURIComponent(d[1].replace(/\+/g," ")))}return b}(window.location.search.substr(1).split("&"))}(jQuery),function(a){function b(){document.getElementById("_taracot_loader_image").style.backgroundImage="url("+q+")",document.getElementById("_taracot_loader_image").style.width=m+"px",document.getElementById("_taracot_loader_image").style.height=n+"px",FPS=Math.round(100/l),v=1/FPS,u=setTimeout(c,v/1e3)}function c(){t+=p,s+=1,s>=o&&(t=0,s=0),document.getElementById("_taracot_loader_image")&&(document.getElementById("_taracot_loader_image").style.backgroundPosition=-t+"px 0"),u=setTimeout(c,1e3*v)}function d(a,b){clearTimeout(r),r=0,genImage=new Image,genImage.onload=function(){r=setTimeout(b,0)},genImage.src=a}function e(){var b=(a(window).height()-a("#_taracot_loader_image").outerHeight())/2,c=(a(window).width()-a("#_taracot_loader_image").outerWidth())/2;a("#_taracot_loader_image").css({position:"absolute",margin:0,top:(b>0?b:0)+"px",left:(c>0?c:0)+"px"})}function f(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1}function g(a){for(var b=x.length;b--;)if(a.keyCode===x[b])return void f(a)}function h(a){f(a)}function i(){window.addEventListener&&window.addEventListener("DOMMouseScroll",h,!1),window.onmousewheel=document.onmousewheel=h,document.onkeydown=g}function j(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",h,!1),window.onmousewheel=document.onmousewheel=document.onkeydown=null}var k=jQuery.extend({},k),l=9,m=100,n=100,o=12,p=100,q="/images/loading.png",r=!1,s=0,t=0,u=!1,v=0,w={init:function(){a("body").append('<div id="_taracot_loader_image_wrap" style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.6);z-index:999;width:100%;height:100%;display:none;"><div id="_taracot_loader_image"></div></div>'),new d(q,b),a(window).resize(e)},show:function(){e(),a("#_taracot_loader_image_wrap").show(),i()},hide:function(){a("#_taracot_loader_image_wrap").hide(),j()}};a.loadingIndicator=function(b){return w[b]?w[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" doesn't exists"):w.init.apply(this,arguments)};var x=[37,38,39,40]}(jQuery),!function(a){var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-notify",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";var c={},d={},e=function(b){return"string"==a.type(b)&&(b={message:b}),arguments[1]&&(b=a.extend(b,"string"==a.type(arguments[1])?{status:arguments[1]}:arguments[1])),new g(b).show()},f=function(a,b){var c;if(a)for(c in d)a===d[c].group&&d[c].close(b);else for(c in d)d[c].close(b)},g=function(e){this.options=a.extend({},g.defaults,e),this.uuid=b.Utils.uid("notifymsg"),this.element=b.$(['<div class="@-notify-message">','<a class="@-close"></a>',"<div></div>","</div>"].join("")).data("notifyMessage",this),this.content(this.options.message),this.options.status&&(this.element.addClass("@-notify-message-"+this.options.status),this.currentstatus=this.options.status),this.group=this.options.group,d[this.uuid]=this,c[this.options.pos]||(c[this.options.pos]=b.$('<div class="@-notify @-notify-'+this.options.pos+'"></div>').appendTo("body").on("click",b.prefix(".@-notify-message"),function(){b.$(this).data("notifyMessage").close()}))};return a.extend(g.prototype,{uuid:!1,element:!1,timout:!1,currentstatus:"",group:!1,show:function(){if(!this.element.is(":visible")){var a=this;c[this.options.pos].show().prepend(this.element);var b=parseInt(this.element.css("margin-bottom"),10);return this.element.css({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0}).animate({opacity:1,"margin-top":0,"margin-bottom":b},function(){if(a.options.timeout){var b=function(){a.close()};a.timeout=setTimeout(b,a.options.timeout),a.element.hover(function(){clearTimeout(a.timeout)},function(){a.timeout=setTimeout(b,a.options.timeout)})}}),this}},close:function(a){var b=this,e=function(){b.element.remove(),c[b.options.pos].children().length||c[b.options.pos].hide(),b.options.onClose.apply(b,[]),delete d[b.uuid]};this.timeout&&clearTimeout(this.timeout),a?e():this.element.animate({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0},function(){e()})},content:function(a){var b=this.element.find(">div");return a?(b.html(a),this):b.html()},status:function(a){return a?(this.element.removeClass("@-notify-message-"+this.currentstatus).addClass("@-notify-message-"+a),this.currentstatus=a,this):this.currentstatus}}),g.defaults={message:"",status:"",timeout:5e3,group:null,pos:"top-center",onClose:function(){}},b.notify=e,b.notify.message=g,b.notify.closeAll=f,e});var dlg_password=new UIkit.modal("#dlg_password"),dlg_email=new UIkit.modal("#dlg_email"),dlg_realname=new UIkit.modal("#dlg_realname"),dlg_auth_finish=new UIkit.modal("#dlg_auth_finish");$.loadingIndicator();var uploader;$("#btn_password").click(function(){dlg_password.show(),pc_password_event_input(),$("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),$("#taracot_pc_error").hide(),$(".taracot_pc_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#password_current").focus()});var pc_password_event_input=function(){var a=evalPassword($("#pc_password").val()),b=20*(a+1);$("#pc_password_strength").css("width",b+"%"),$("#pc_password_strength").html(_lang_vars["password_strength_"+a]),$("#pc_password_strength").parent().removeClass("uk-progress-success"),$("#pc_password_strength").parent().removeClass("uk-progress-warning"),$("#pc_password_strength").parent().removeClass("uk-progress-danger"),1>=a&&$("#pc_password_strength").parent().addClass("uk-progress-danger"),(2==a||3==a)&&$("#pc_password_strength").parent().addClass("uk-progress-warning"),4==a&&$("#pc_password_strength").parent().addClass("uk-progress-success"),$("#pc_password_match").css("color","#eee"),a>0&&$("#pc_password").val()==$("#pc_password_repeat").val()&&$("#pc_password_match").css("color","#9fd256")},pc_password_repeat_event_input=function(){var a=evalPassword($("#pc_password").val());$("#pc_password_match").css("color","#eee"),a>0&&$("#pc_password").val()==$("#pc_password_repeat").val()&&$("#pc_password_match").css("color","#9fd256")};$("#pc_password").on("input",pc_password_event_input),$("#pc_password_repeat").on("input",pc_password_repeat_event_input);var set_password_event_input=function(){var a=evalPassword($("#set_password").val()),b=20*(a+1);$("#set_password_strength").css("width",b+"%"),$("#set_password_strength").html(_lang_vars["password_strength_"+a]),$("#set_password_strength").parent().removeClass("uk-progress-success"),$("#set_password_strength").parent().removeClass("uk-progress-warning"),$("#set_password_strength").parent().removeClass("uk-progress-danger"),1>=a&&$("#set_password_strength").parent().addClass("uk-progress-danger"),(2==a||3==a)&&$("#set_password_strength").parent().addClass("uk-progress-warning"),4==a&&$("#set_password_strength").parent().addClass("uk-progress-success"),$("#set_password_match").css("color","#eee"),a>0&&$("#set_password").val()==$("#set_password_repeat").val()&&$("#set_password_match").css("color","#9fd256")},set_password_repeat_event_input=function(){var a=evalPassword($("#set_password").val());$("#set_password_match").css("color","#eee"),a>0&&$("#set_password").val()==$("#set_password_repeat").val()&&$("#set_password_match").css("color","#9fd256")};$("#set_password").on("input",set_password_event_input),$("#set_password_repeat").on("input",set_password_repeat_event_input),$("#btn_pc_save").click(function(){return $(".taracot_pc_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#pc_password_current").val().match(/^.{5,80}$/)?$("#pc_password").val().match(/^.{8,80}$/)&&$("#pc_password").val()==$("#pc_password_repeat").val()?($("#taracot_pc_loading").show(),$("#dlg_password_form_wrap").hide(),$("#taracot_pc_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#pc_password_current").val(),password_new:$("#pc_password").val()},dataType:"json",success:function(a){dlg_allow_close(!0),1!=a.result?($("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),a.field&&("pc_password"==a.field&&$("#pc_password_repeat").addClass("uk-form-danger"),$("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_pc_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_pc_error").show()):(dlg_password.hide(),UIkit.notify({message:_lang_vars.password_saved,status:"success",timeout:2e3,pos:"top-center"}))},error:function(){dlg_allow_close(!0),$("#taracot_pc_loading").hide(),$("#dlg_password_form_wrap").show(),$("#taracot_pc_error").html(_lang_vars.ajax_failed),$("#taracot_pc_error").show(),$("#pc_password_current").focus()}})):($("#pc_password").addClass("uk-form-danger"),$("#pc_password_repeat").addClass("uk-form-danger"),$("#pc_password").focus(),$("#taracot_pc_error").html(_lang_vars.invalid_password_syntax),void $("#taracot_pc_error").show()):($("#pc_password_current").addClass("uk-form-danger"),$("#pc_password_current").focus(),$("#taracot_pc_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_pc_error").show())}),$(".taracot_pc_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_pc_save").click()}),$("#btn_email").click(function(){dlg_email.show(),$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),$("#taracot_ec_error").hide(),$(".taracot_ec_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#ec_email").focus()}),$("#btn_ec_save").click(function(){return $(".taracot_ec_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#ec_email").val().match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?$("#ec_password_current").val().match(/^.{5,80}$/)?($("#taracot_ec_loading").show(),$("#dlg_email_form_wrap").hide(),$("#taracot_ec_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#ec_password_current").val(),email_new:$("#ec_email").val()},dataType:"json",success:function(a){$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),1!=a.result?(dlg_allow_close(!0),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_ec_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_ec_error").show()):($("#dlg_email_form_wrap").html(_lang_vars.email_saved),setTimeout(function(){location.href="/auth/profile?rnd="+Math.random().toString().replace(".","")},3e3))},error:function(){dlg_allow_close(!0),$("#taracot_ec_loading").hide(),$("#dlg_email_form_wrap").show(),$("#taracot_ec_error").html(_lang_vars.ajax_failed),$("#taracot_ec_error").show(),$("#ec_password_current").focus()}})):($("#ec_password_current").addClass("uk-form-danger"),$("#ec_password_current").focus(),$("#taracot_ec_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_ec_error").show()):($("#ec_email").addClass("uk-form-danger"),$("#ec_email").focus(),$("#taracot_ec_error").html(_lang_vars.invalid_email_syntax),void $("#taracot_ec_error").show())}),$(".taracot_ec_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_ec_save").click()}),$(".taracot_set_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_set_save").click()}),$("#btn_realname").click(function(){dlg_realname.show(),$("#taracot_rn_loading").hide(),$("#dlg_realname_form_wrap").show(),$("#taracot_rn_error").hide(),$(".taracot_rn_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#rn_realname").val(auth_realname),$("#rn_realname").select(),$("#rn_realname").focus()}),$("#btn_rn_save").click(function(){return $(".taracot_rn_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#rn_realname").val().match(/^.{1,40}$/)?$("#rn_password_current").val().match(/^.{5,80}$/)?($("#taracot_rn_loading").show(),$("#dlg_realname_form_wrap").hide(),$("#taracot_rn_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/profile/process",data:{password:$("#rn_password_current").val(),realname:$("#rn_realname").val()},dataType:"json",success:function(a){$("#taracot_rn_loading").hide(),$("#dlg_realname_form_wrap").show(),1!=a.result?(dlg_allow_close(!0),a.field&&($("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_rn_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_rn_error").show()):(dlg_realname.hide(),a.realname?($("#profile_realname").html(a.realname),auth_realname=a.realname):($("#profile_realname").html(""),auth_realname=""),UIkit.notify({message:_lang_vars.realname_saved,status:"success",timeout:2e3,pos:"top-center"}))},error:function(){dlg_allow_close(!0),$("#taracot_rn_loading").hide(),$("#dlg_realname_form_wrap").show(),$("#taracot_rn_error").html(_lang_vars.ajax_failed),$("#taracot_rn_error").show(),$("#rn_password_current").focus()}})):($("#rn_password_current").addClass("uk-form-danger"),$("#rn_password_current").focus(),$("#taracot_rn_error").html(_lang_vars.invalid_current_password_syntax),void $("#taracot_rn_error").show()):($("#rn_realname").addClass("uk-form-danger"),$("#rn_realname").focus(),$("#taracot_rn_error").html(_lang_vars.invalid_realname_syntax),void $("#taracot_rn_error").show())}),$("#btn_set_save").click(function(){return $(".taracot_set_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#set_username").val().match(/^[A-Za-z0-9_\-]{3,20}$/)?$("#set_password").val().match(/^.{8,80}$/)&&$("#set_password").val()==$("#set_password_repeat").val()?($("#taracot_set_loading").show(),$("#dlg_auth_finish_form_wrap").hide(),$("#taracot_set_error").hide(),dlg_allow_close(!1),void $.ajax({type:"POST",url:"/auth/oauth/process",data:{username_new:$("#set_username").val(),password_new:$("#set_password").val()},dataType:"json",success:function(a){dlg_allow_close(!0),1!=a.result?($("#taracot_set_loading").hide(),$("#dlg_auth_finish_form_wrap").show(),a.field&&("set_password"==a.field&&$("#set_password_repeat").addClass("uk-form-danger"),$("#"+a.field).addClass("uk-form-danger"),$("#"+a.field).focus()),$("#taracot_set_error").html(a.error?a.error:_lang_vars.ajax_failed),$("#taracot_set_error").show()):(dlg_auth_finish.hide(),$("#taracot_oauth_finish_wrap").hide(),a.username&&$("#profile_username").html(a.username),UIkit.notify({message:_lang_vars.username_password_saved,status:"success",timeout:2e3,pos:"top-center"}))},error:function(){dlg_allow_close(!0),$("#taracot_set_loading").hide(),$("#dlg_auth_finish_form_wrap").show(),$("#taracot_set_error").html(_lang_vars.ajax_failed),$("#taracot_set_error").show(),$("#set_password_current").focus()}})):($("#set_password").addClass("uk-form-danger"),$("#set_password_repeat").addClass("uk-form-danger"),$("#set_password").focus(),$("#taracot_set_error").html(_lang_vars.invalid_password_syntax),void $("#taracot_set_error").show()):($("#set_username").addClass("uk-form-danger"),$("#set_username").focus(),$("#taracot_set_error").html(_lang_vars.invalid_username_syntax),void $("#taracot_set_error").show())}),$(".taracot_rn_field").bind("keypress",function(a){submitOnEnter(a)&&$("#btn_rn_save").click()}),$("#btn_social_auth_finish").click(function(){dlg_auth_finish.show(),set_password_event_input(),$("#taracot_set_loading").hide(),$("#dlg_auth_finish_form_wrap").show(),$("#taracot_set_error").hide(),$(".taracot_set_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#set_username").focus()}),$("#profile_set_avatar").click(function(){});var dlg_allow_close=function(a){dlg_password.options.bgclose=a,dlg_password.options.keyboard=a,dlg_email.options.bgclose=a,dlg_email.options.keyboard=a,dlg_realname.options.bgclose=a,dlg_realname.options.keyboard=a,dlg_auth_finish.options.bgclose=a,dlg_auth_finish.options.keyboard=a},uploader_init=function(){uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"profile_set_avatar",drop_element:"profile_set_avatar_dnd",url:"/auth/profile/process",flash_swf_url:"/js/plupload/moxie.swf",silverlight_xap_url:"/js/plupload/moxie.xap",filters:{max_file_size:"3mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}]},multi_selection:!1}),uploader.init(),uploader.bind("FilesAdded",function(){uploader.start()}),uploader.bind("Error",function(a,b){$.loadingIndicator("hide"),UIkit.notify({message:b.message,status:"danger",timeout:2e3,pos:"top-center"})}),uploader.bind("UploadProgress",function(){$.loadingIndicator("show")}),uploader.bind("FileUploaded",function(upldr,file,object){$.loadingIndicator("hide");var data;try{data=eval(object.response)}catch(err){data=eval("("+object.response+")")}data&&(0===data.result&&data.error&&UIkit.notify({message:data.error,status:"danger",timeout:2e3,pos:"top-center"}),1==data.result&&data.avatar_id&&$("#profile_avatar").attr("src","/images/avatars/"+data.avatar_id+".jpg?rnd="+Math.random().toString().replace(".","")))})};$(document).ready(function(){uploader_init()});