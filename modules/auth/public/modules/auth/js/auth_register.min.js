function submitOnEnter(a){var b;if(window.event)b=window.event.keyCode;else{if(!a)return!1;b=a.keyCode?a.keyCode:a.which}return 13==b&&(!window.previousKeyCode||33!=window.previousKeyCode&&34!=window.previousKeyCode&&39!=window.previousKeyCode&&40!=window.previousKeyCode)?!0:(window.previousKeyCode=b,!1)}function getUrlVars(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b}function evalPassword(a){var b=a.replace(/(^\s+|\s+$)/g,"");if("undefined"==typeof b||null===b||!b||b.length<8)return 0;var c=/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/;return c.test(b)?4:(c=/(?=.*\d)(?=.*[A-Z])(?=.*[a-z])/,c.test(b)?3:(c=/(?=.*\d)(?=.*[a-z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*\d)(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*[a-z])(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?3:(c=/(?=.*[a-z])(?=.*[A-Z])/,c.test(b)?2:(c=/(?=.*[a-z])(?=.*\d)/,c.test(b)?2:(c=/(?=.*[A-Z])(?=.*\d)/,c.test(b)?2:(c=/(?=.*[a-z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''""()\[\]{}])/,c.test(b)?2:(c=/(?=.*[A-Z])(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''""()\[\]{}])/,c.test(b)?2:(c=/(?=.*\d)(?=.*[\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}])/,c.test(b)?2:(c=/(?=.*[a-zA-Z0-9\^\\\/*+.,:;@&=#$%_\-!?<>''`�""()\[\]{}\u0400-\u052f \u00a1-\u024f])/,c.test(b)?1:0)))))))))))}var captcha_loading=!1,load_captcha=function(){return"undefined"!=typeof captcha_type&&"png"==captcha_type?void $("#reg_captcha_img").attr("src","/auth/captcha?rnd="+Math.random().toString().replace(".","")):void(captcha_loading||(captcha_loading=!0,$.ajax({type:"POST",url:"/auth/captcha",data:{},dataType:"json",success:function(a){captcha_loading=!1,a.img?$("#reg_captcha_img").attr("src","data:image/jpeg;base64,"+a.img):($("#taracot-reg-error").html(_lang_vars.ajax_failed),$("#taracot-reg-error").show())},error:function(){$("#taracot-reg-error").html(_lang_vars.ajax_failed),$("#taracot-reg-error").show(),captcha_loading=!1}})))};$("#reg_captcha_img").click(load_captcha),$("#reg_captcha").val(""),$("#btn_register").click(function(){return $("#taracot-reg-error").hide(),$(".taracot-auth-field").removeClass("uk-form-danger"),$("#reg_username").val().match(/^[A-Za-z0-9_\-]{3,20}$/)?$("#reg_password").val().match(/^.{8,80}$/)&&$("#reg_password").val()==$("#reg_password_repeat").val()?captcha_req&&!$("#reg_captcha").val().match(/^[0-9]{4}$/)?($("#reg_captcha").addClass("uk-form-danger"),$("#reg_captcha").focus(),$("#taracot-reg-error").html(_lang_vars.invalid_captcha),void $("#taracot-reg-error").show()):$("#reg_email").val().match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?($("#reg_wrap").hide(),$("#reg_loading").show(),$("#taracot-reg-error").hide(),void $.ajax({type:"POST",url:"/auth/register/process",data:{username:$("#reg_username").val(),email:$("#reg_email").val(),password:$("#reg_password").val(),captcha:$("#reg_captcha").val()},dataType:"json",success:function(a){1!=a.result?($("#reg_wrap").show(),$("#reg_loading").hide(),$("#reg_captcha").val(""),a.field&&($("#"+a.field).addClass("uk-form-danger"),"reg_password"==a.field&&$("#reg_password_repeat").addClass("uk-form-danger"),$("#"+a.field).select(),$("#"+a.field).focus()),$("#captcha_div").show(),captcha_req=!0,a.error&&($("#taracot-reg-error").html(a.error),$("#taracot-reg-error").show()),load_captcha()):($("#reg_loading").hide(),$("#reg_success").show())},error:function(){$("#reg_wrap").show(),$("#reg_loading").hide(),$("#taracot-reg-error").html(_lang_vars.ajax_failed),$("#taracot-reg-error").show(),$("#reg_captcha").val(""),load_captcha()}})):($("#reg_email").addClass("uk-form-danger"),$("#reg_email").focus(),$("#taracot-reg-error").html(_lang_vars.invalid_email_syntax),void $("#taracot-reg-error").show()):($("#reg_password").addClass("uk-form-danger"),$("#reg_password_repeat").addClass("uk-form-danger"),$("#reg_password").focus(),$("#taracot-reg-error").html(_lang_vars.invalid_password_syntax),void $("#taracot-reg-error").show()):($("#reg_username").addClass("uk-form-danger"),$("#reg_username").focus(),$("#taracot-reg-error").html(_lang_vars.invalid_username_syntax),void $("#taracot-reg-error").show())}),$(".taracot-auth-field").bind("keypress",function(a){submitOnEnter(a)&&($("#btn_register").click(),a.preventDefault())}),$("#reg_username").focus();var reg_password_event_input=function(){var a=evalPassword($("#reg_password").val()),b=20*(a+1);$("#reg_password_strength").css("width",b+"%"),$("#reg_password_strength").html(_lang_vars["password_strength_"+a]),$("#reg_password_strength").parent().removeClass("uk-progress-success"),$("#reg_password_strength").parent().removeClass("uk-progress-warning"),$("#reg_password_strength").parent().removeClass("uk-progress-danger"),1>=a&&$("#reg_password_strength").parent().addClass("uk-progress-danger"),(2==a||3==a)&&$("#reg_password_strength").parent().addClass("uk-progress-warning"),4==a&&$("#reg_password_strength").parent().addClass("uk-progress-success"),$("#reg_password_match").css("color","#eee"),a>0&&$("#reg_password").val()==$("#reg_password_repeat").val()&&$("#reg_password_match").css("color","#9fd256")},reg_password_repeat_event_input=function(){var a=evalPassword($("#reg_password").val());$("#reg_password_match").css("color","#eee"),a>0&&$("#reg_password").val()==$("#reg_password_repeat").val()&&$("#reg_password_match").css("color","#9fd256")};$("#reg_password").on("input",reg_password_event_input),$("#reg_password_repeat").on("input",reg_password_repeat_event_input),$(document).ready(function(){load_captcha()});