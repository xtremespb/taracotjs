var file_ids={},file_types={},file_mime={},current_dir="",up_dir=[],clpbrd={mode:null,dir:null,files:[]},taracot_dlg_edit=new $.UIkit.modal("#taracot_dlg_edit"),taracot_dlg_upload=new $.UIkit.modal("#taracot_dlg_upload",{bgclose:!1,keyboard:!1}),buttons_state=[],uploader,refresh_required=!1,shifty_select_handler=function(){$(".taracot-fade").addClass("taracot-fade-elipsis");for(var a=$(".taracot-files-item").getSelected("taracot-files-item-selected"),b=0;b<a.length;b++){var c=a[b].replace("taracot_file_","");$("#taracot_el_"+c).removeClass("taracot-fade-elipsis"),1==a.length&"d"==file_types[c]?$("#btn_down").attr("disabled",!1):$("#btn_down").attr("disabled",!0),1==a.length&"d"!=file_types[c]?$("#btn_select").attr("disabled",!1):$("#btn_select").attr("disabled",!0)}},shifty_unselect_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if($("#btn_down").attr("disabled",!0),1==a.length){var b=a[0].replace("taracot_file_","");"d"==file_types[b]&&$("#btn_down").attr("disabled",!1)}},shifty_handler=function(){shifty_select_handler(),shifty_unselect_handler()},load_files_data=function(a){save_buttons_state(),$(".taracot-files-button").attr("disabled",!0),$("#files_grid_progress").show(),$("#files_grid").empty(),file_ids={},file_types={},$("#files_grid").click(),$.ajax({type:"POST",url:"/cp/browse/data/load",data:{dir:a,io:io},dataType:"json",success:function(b){if($("#files_grid_progress").hide(),b&&1==b.status){load_buttons_state(),shifty_handler(),$("#btn_down").attr("disabled",!0),$(".taracot-files-panel").removeClass("uk-hidden"),a?$("#btn_up").attr("disabled",!1):$("#btn_up").attr("disabled",!0);for(var c=0;c<b.files.length;c++){var d="/modules/files/images/folder.png";"f"==b.files[c].type&&(d="/modules/files/images/file.png",b.files[c].mime.match(/^image\//)&&(d="/modules/files/images/image.png"),(b.files[c].mime.match(/excel/)||b.files[c].mime.match(/csv/)||b.files[c].mime.match(/spreadsheet/))&&(d="/modules/files/images/excel.png"),(b.files[c].mime.match(/msword/)||b.files[c].mime.match(/rtf/))&&(d="/modules/files/images/word.png"),b.files[c].mime.match(/text\/plain/)&&(d="/modules/files/images/txt.png"),b.files[c].mime.match(/video/)&&(d="/modules/files/images/video.png"),b.files[c].mime.match(/pdf/)&&(d="/modules/files/images/pdf.png"),b.files[c].mime.match(/photoshop/)&&(d="/modules/files/images/psd.png"),(b.files[c].mime.match(/zip/)||b.files[c].mime.match(/rar/))&&(d="/modules/files/images/archive.png")),b.files[c].thumb&&(d="/files/"+current_dir+"/___thumb_"+b.files[c].thumb+".jpg"),file_ids[c]=b.files[c].name,file_types[c]=b.files[c].type,file_mime[c]=b.files[c].mime,$("#files_grid").append('<li class="uk-thumbnail taracot-files-item" id="taracot_file_'+c+'"><div class="uk-badge uk-badge-notification uk-badge-success" style="position:absolute;display:none">0</div><img src="'+d+'" style="max-height:70px;max-width:70px"><div class="uk-thumbnail-caption taracot-thumbnail-caption"><div class="taracot-fade taracot-fade-elipsis" id="taracot_el_'+c+'">'+b.files[c].name+"</div></div></li>")}$(".taracot-files-item").shifty({className:"taracot-files-item-selected",select:function(){shifty_select_handler()},unselect:function(){shifty_unselect_handler()}}),$(".taracot-files-item").bind("dblclick",dblclick_handler),$("#taracot_total_files").html(b.files.length),b.files.length||$("#files_grid").html(_lang_vars.no_files)}else{var e=_lang_vars.ajax_failed;b.error&&(e=b.error),$.UIkit.notify({message:e,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot_total_files").html("0")}},error:function(){$("#files_grid_progress").hide(),$("#files_grid").html(_lang_vars.ajax_failed),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot_total_files").html("0"),load_buttons_state(),shifty_handler()}})},dblclick_handler=function(){var a=$(this).attr("id").replace("taracot_file_","");"d"==file_types[a]&&(up_dir.push(current_dir),current_dir+="/"+file_ids[a],current_dir=current_dir.replace(/^\//,""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir))},btnup_handler=function(){up_dir.length?(current_dir=up_dir[up_dir.length-1],delete up_dir[up_dir.length-1]):current_dir="","undefined"==typeof current_dir&&(current_dir=""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir)},btndown_handler=function(){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(a.length&&!(a.length>1)){var b=a[0].replace("taracot_file_","");"d"==file_types[b]&&(up_dir.push(current_dir),current_dir+="/"+file_ids[b],current_dir=current_dir.replace(/^\//,""),$("#taracot-files-current-dir").html("/"+current_dir),load_files_data(current_dir))}},btnselect_hander=function(){if(CKEditorFuncNum){var a=$(".taracot-files-item").getSelected("taracot-files-item-selected");if(!a.length||a.length>1)return;var b="/files/"+$("#taracot-files-current-dir").html();"/"!=b&&(b+="/"),b+=file_ids[a[0].replace("taracot_file_","")],window.opener.CKEDITOR.tools.callFunction(CKEditorFuncNum,b),close()}},btnrefresh_hanlder=function(){load_files_data(current_dir)},save_buttons_state=function(){buttons_state=[],$(".taracot-files-button").each(function(){buttons_state.push($(this).attr("disabled"))})},load_buttons_state=function(){$(".taracot-files-button").each(function(a){buttons_state.length<a||(buttons_state[a]?$(this).attr("disabled",!0):$(this).attr("disabled",!1))})},init_buttons_state=function(){$("#btn_refresh").attr("disabled",!1),$("#btn_down").attr("disabled",!0),$("#btn_up").attr("disabled",!0),$("#btn_select").attr("disabled",!0)};$("#btn_refresh").click(btnrefresh_hanlder),$("#btn_up").click(btnup_handler),$("#btn_down").click(btndown_handler),$("#btn_select").click(btnselect_hander),$(document).ready(function(){io||(io=void 0),$("#files_grid_progress").hide(),init_buttons_state(),load_files_data(),$("#files_grid").click(function(a){"files_grid"===a.target.id&&($(".taracot-files-item").removeClass("taracot-files-item-selected"),$(".taracot-fade").addClass("taracot-fade-elipsis"),$("#btn_down").attr("disabled",!0),shifty_handler())})});var check_filename=function(a){var b=a.replace(/^\s+|\s+$/g,"");return!b||b.length>80?!1:b.match(/^\./)?!1:b.match(/^[\^<>\:\"\/\\\|\?\*\x00-\x1f]+$/)?!1:!0},check_directory=function(a){if(!a)return!0;var b=a.replace(/^\s+|\s+$/g,"");return b.length>40?!1:b.match(/^\./)?!1:b.match(/^\\/)?!1:b.match(/^[\^<>\:\"\\\|\?\*\x00-\x1f]+$/)?!1:!0};