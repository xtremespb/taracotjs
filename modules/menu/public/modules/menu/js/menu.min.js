var taracot_dlg_menu_edit=new $.UIkit.modal("#taracot_dlg_menu_edit"),edit_id,edit_lng;$("#btn_item_add").click(function(){taracot_dlg_menu_edit.show(),$(".taracot_dlg_menu_edit_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#taracot_dlg_menu_edit_text").focus(),edit_id=void 0}),$(".taracot_dlg_menu_edit_field").bind("keypress",function(a){submitOnEnter(a)&&$("#taracot_dlg_menu_edit_btn_save").click()}),$("#btn_item_delall").click(function(){confirm(_lang_vars.confirm_menu_deleteall)&&$("#menu_nest").empty()}),$("#btn_menu_save_cancel").click(function(){confirm(_lang_vars.confirm_menu_cancel)&&($("#menu_nest").empty(),$("#menu_editor").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1))}),$("#btn_load_menu").click(function(){$("#load_menu_loading").removeClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!0),$("#menu_nest").empty(),edit_lng=$("#menu_lang").val(),$.ajax({type:"POST",url:"/cp/menu/data/load",dataType:"json",data:{lng:edit_lng},success:function(a){if($("#load_menu_loading").addClass("uk-hidden"),1==a.status)a.menu_source&&($("#menu_nest").html(a.menu_source),bind_menu_handlers()),$("#menu_editor").removeClass("uk-hidden"),$("#menu_edit_lang").html(edit_lng);else{$("#btn_load_menu").attr("disabled",!1);var b=_lang_vars.ajax_failed;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#load_menu_loading").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})}),$("#btn_menu_save").click(function(){taracot_ajax_progress_indicator("body",!0);var a=$("#menu_nest").html(),b='<nav class="uk-navbar">'+walk_nest_uikit($("#menu_nest"))+"</nav>",c=walk_nest_raw($("#menu_nest"));$.ajax({type:"POST",url:"/cp/menu/data/save",dataType:"json",data:{lng:edit_lng,menu_source:a,menu_uikit:b,menu_raw:c},success:function(a){if(taracot_ajax_progress_indicator("body",!1),1==a.status)$("#menu_editor").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1),$.UIkit.notify({message:_lang_vars.save_success,status:"success",timeout:2e3,pos:"top-center"});else{var b=_lang_vars.ajax_failed;a.error&&(b=a.error),$.UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){taracot_ajax_progress_indicator("body",!1),$.UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})}),$("#taracot_dlg_menu_edit_btn_save").click(function(){$(".taracot_dlg_menu_edit_field").each(function(){$(this).removeClass("uk-form-danger")});var a=!1;return $("#taracot_dlg_menu_edit_text").val()||($("#taracot_dlg_menu_edit_text").addClass("uk-form-danger"),$("#taracot_dlg_menu_edit_text").select(),$("#taracot_dlg_menu_edit_text").focus(),a=!0),$("#taracot_dlg_menu_edit_url").val()||($("#taracot_dlg_menu_edit_url").addClass("uk-form-danger"),a||($("#taracot_dlg_menu_edit_text").select(),$("#taracot_dlg_menu_edit_text").focus()),a=!0),a?void $.UIkit.notify({message:_lang_vars.form_contains_errors,status:"danger",timeout:2e3,pos:"top-center"}):(taracot_dlg_menu_edit.hide(),void(edit_id?($("#"+edit_id).children(".uk-nestable-item").children("span.uk-nestable-item-text").html($("#taracot_dlg_menu_edit_text").val()),$("#"+edit_id).children(".uk-nestable-item").children("a.uk-nestable-item-url").html($("#taracot_dlg_menu_edit_url").val()),$("#"+edit_id).children(".uk-nestable-item").children("a.uk-nestable-item-url").attr("href",$("#taracot_dlg_menu_edit_url").val())):($("#menu_nest").append('<li id="taracot_menu_'+Date.now()+'" class="uk-nestable-list-item"><div class="uk-nestable-item"><div class="uk-nestable-handle"></div><div data-nestable-action="toggle"></div>&nbsp;<span class="uk-nestable-item-text">'+$("#taracot_dlg_menu_edit_text").val()+'</span>&nbsp;(<a href="'+$("#taracot_dlg_menu_edit_url").val()+'" class="uk-nestable-item-url">'+$("#taracot_dlg_menu_edit_url").val()+'</a>)&nbsp;&nbsp;&nbsp;<button class="uk-button uk-button-small taracot-btn-menu-edit"><i class="uk-icon-edit"></i></button>&nbsp;<button class="uk-button uk-button-small uk-button-danger taracot-btn-menu-delete"><i class="uk-icon-trash-o"></i></button></div></li>'),bind_menu_handlers())))});var bind_menu_handlers=function(){$(".taracot-btn-menu-delete").unbind(),$(".taracot-btn-menu-edit").unbind(),$(".taracot-btn-menu-delete").click(function(){var a=$(this).parent().parent().children(".uk-nestable-item").children("span.uk-nestable-item-text").html();confirm(_lang_vars.confirm_menu_delete+"\n\n"+a)&&$(this).parent().parent().remove()}),$(".taracot-btn-menu-edit").click(function(){var a=$(this).parent().parent().children(".uk-nestable-item").children("span.uk-nestable-item-text").html(),b=$(this).parent().parent().children(".uk-nestable-item").children("a.uk-nestable-item-url").html(),c=$(this).parent().parent().attr("id");edit_id=c,$("#taracot_dlg_menu_edit_text").val(a),$("#taracot_dlg_menu_edit_url").val(b),$("#taracot_dlg_menu_edit_page").val(""),taracot_dlg_menu_edit.show(),$(".taracot_dlg_menu_edit_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#taracot_dlg_menu_edit_text").focus()})};$(document).ready(function(){$("#menu_nest").empty(),$("#menu_lang").val(locales[0]),$("#btn_load_menu").attr("disabled",!1),$("#taracot_dlg_menu_edit_page").change(function(){$("#taracot_dlg_menu_edit_text").val($("#"+this.id+" option:selected").text().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")),$("#taracot_dlg_menu_edit_url").val($(this).val())})});var taracot_ajax_progress_indicator=function(a,b){if(b){var c=$(a).offset();$(".taracot-progress").css({top:c.top,left:c.left,width:$(a).width(),height:$(a).height()}),$(".taracot-progress").removeClass("uk-hidden")}else $(".taracot-progress").addClass("uk-hidden")},walk_nest_uikit=function(a,b){var c="";b&&(c+='<div class="uk-dropdown uk-dropdown-navbar">');var d="";d=b?"uk-nav uk-nav-navbar":"uk-navbar-nav",c+='<ul class="'+d+'">';var e=$(a).children("li");return e.each(function(){var a=$(this).children(".uk-nestable-item").children("span.uk-nestable-item-text").html(),b=$(this).children(".uk-nestable-item").children("a.uk-nestable-item-url").html(),d="",e="",f=$(this).children("ul.uk-nestable-list");f.html()&&(d=" data-uk-dropdown",e=' class="uk-parent"'),c+="<li"+e+d+'><a href="'+b+'">'+a+"</a>",f.html()&&(c+=walk_nest_uikit(f,!0)),c+="</li>"}),c+="</ul>",b&&(c+="</div>"),c},walk_nest_raw=function(a){var b="";b+="<ul>";var c=$(a).children("li");return c.each(function(){var a=$(this).children(".uk-nestable-item").children("span.uk-nestable-item-text").html(),c=$(this).children(".uk-nestable-item").children("a.uk-nestable-item-url").html(),d=$(this).children("ul.uk-nestable-list");b+='<li><a href="'+c+'">'+a+"</a>",d.html()&&(b+=walk_nest_raw(d)),b+="</li>"}),b+="</ul>"};